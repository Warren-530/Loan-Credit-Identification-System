# Visual Changes Reference

## Before vs After Comparison

### 1. Hardcoded Badges (OLD)
```
âŒ BEFORE:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š Requested: RM 55,000                     â”‚
â”‚ ğŸ“… Tenure: 24 Months        [HARDCODED!]   â”‚
â”‚ ğŸ¢ Business: F&B (Retail)   [HARDCODED!]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Dynamic Badges (NEW)
```
âœ… AFTER:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š Requested: RM {from Application Form}    â”‚
â”‚ ğŸ“… Tenure: {from "PERIOD" field}           â”‚
â”‚ ğŸ¢ {from "LOAN TYPE" checkbox}             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Example for Car Loan:
â”‚ ğŸ“Š Requested: RM 55,000                     â”‚
â”‚ ğŸ“… Tenure: 7 years (84 months)             â”‚
â”‚ ğŸ¢ Car Loan                                 â”‚
```

---

## New Financial Metrics Section

### Visual Layout
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  ğŸ“ˆ Financial Metrics Analysis                                â•‘
â•‘  Comprehensive financial ratios calculated from documents     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                               â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â•‘
â•‘  â”‚ Debt Service Ratio     â”‚  â”‚ Net Disposable Income  â”‚     â•‘
â•‘  â”‚ [Low Risk Badge]       â”‚  â”‚ [Sufficient Badge]     â”‚     â•‘
â•‘  â”‚                        â”‚  â”‚                        â”‚     â•‘
â•‘  â”‚     30.5%              â”‚  â”‚    RM 2,573            â”‚     â•‘
â•‘  â”‚                        â”‚  â”‚                        â”‚     â•‘
â•‘  â”‚ ğŸ“Š Formula: ...        â”‚  â”‚ ğŸ“Š Formula: ...        â”‚     â•‘
â•‘  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚     â•‘
â•‘  â”‚ â”‚ Existing: RM 430 â”‚   â”‚  â”‚ â”‚ Income: RM 3,703 â”‚   â”‚     â•‘
â•‘  â”‚ â”‚ New Loan: RM 700 â”‚   â”‚  â”‚ â”‚ - Debt: RM 1,130 â”‚   â”‚     â•‘
â•‘  â”‚ â”‚ Total: RM 1,130  â”‚   â”‚  â”‚ â”‚ - Living: RM 700 â”‚   â”‚     â•‘
â•‘  â”‚ â”‚ Income: RM 3,703 â”‚   â”‚  â”‚ â”‚ = RM 2,573       â”‚   â”‚     â•‘
â•‘  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚     â•‘
â•‘  â”‚ ğŸ’¡ "PTPTN: RM 180..." â”‚  â”‚ ğŸ’° Real Buffer: RM...  â”‚     â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â•‘
â•‘                                                               â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â•‘
â•‘  â”‚ Per Capita Income      â”‚  â”‚ Savings Rate           â”‚     â•‘
â•‘  â”‚ [Struggling Badge]     â”‚  â”‚ [High Saver Badge]     â”‚     â•‘
â•‘  â”‚                        â”‚  â”‚                        â”‚     â•‘
â•‘  â”‚     RM 529             â”‚  â”‚      73%               â”‚     â•‘
â•‘  â”‚                        â”‚  â”‚                        â”‚     â•‘
â•‘  â”‚ (calculation...)       â”‚  â”‚ (calculation...)       â”‚     â•‘
â•‘  â”‚ âš ï¸ Risk Flag!         â”‚  â”‚                        â”‚     â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â•‘
â•‘                                                               â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â•‘
â•‘  â”‚ Cost of Living Ratio   â”‚  â”‚ LTV (if applicable)    â”‚     â•‘
â•‘  â”‚ [Frugal Badge]         â”‚  â”‚ [Standard Badge]       â”‚     â•‘
â•‘  â”‚                        â”‚  â”‚                        â”‚     â•‘
â•‘  â”‚     18.9%              â”‚  â”‚      90%               â”‚     â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â•‘
â•‘                                                               â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â•‘
â•‘  â”‚ ğŸ“š Understanding Financial Metrics                  â”‚     â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â•‘
â•‘  â”‚ DSR: Measures repayment pressure. Warning at 60%.  â”‚     â•‘
â•‘  â”‚ NDI: Cash after debts. Emergency buffer capacity.  â”‚     â•‘
â•‘  â”‚ Per Capita: Income/family. Reveals hidden stress.  â”‚     â•‘
â•‘  â”‚ Savings Rate: Closing vs income. Financial habits. â”‚     â•‘
â•‘  â”‚ Cost of Living: Expenses %. Spending patterns.     â”‚     â•‘
â•‘  â”‚ LTV: For Car/Housing. Malaysia max 90% standard.   â”‚     â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## Color Coding System

### Assessment Badges
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GREEN BADGES       â”‚  â† Low Risk / Good
â”‚  (Emerald 100/800)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AMBER BADGES       â”‚  â† Moderate Risk / Warning
â”‚  (Amber 100/800)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RED BADGES         â”‚  â† High Risk / Critical
â”‚  (Rose 100/800)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Metric Values Colors
- **DSR**: Purple-700
- **NDI**: Emerald-700
- **Per Capita**: Blue-700
- **Savings**: Green-700
- **Cost of Living**: Indigo-700
- **LTV**: Orange-700

---

## Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. USER UPLOADS 4 DOCUMENTS                                 â”‚
â”‚    â†’ Application Form, Bank Statement, Essay, Payslip       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. BACKEND AI PROCESSES                                     â”‚
â”‚    â†’ Extract text from all 4 PDFs                           â”‚
â”‚    â†’ Parse Application Form fields                          â”‚
â”‚    â†’ Calculate 6 financial metrics                          â”‚
â”‚    â†’ Store in analysis_result JSON                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. FRONTEND DISPLAYS                                        â”‚
â”‚    âœ“ Dynamic badges from applicant_profile                  â”‚
â”‚    âœ“ Financial Metrics section (if available)               â”‚
â”‚    âœ“ Graceful degradation (old apps without metrics)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Example Real Data

### Applicant: Nurul Aisyah (Car Loan Example)

**Application Form Data:**
- Name: Nurul Aisyah binti Abdullah
- IC: 950123-14-5678
- Loan Type: âœ“ Car Loan
- Amount: RM 55,000
- Period: 7 years (84 months)
- Annual Income: RM 44,436
- Family Members: 7

**Calculated Metrics:**
1. **DSR**: 30.5% â†’ âœ… Low Risk (<40%)
2. **NDI**: RM 2,573 â†’ âš ï¸ Tight (RM 1000-2000)
3. **Per Capita**: RM 529 â†’ âŒ Struggling (<RM1000) + ğŸš© Risk Flag
4. **Savings**: 73% â†’ âœ… High Saver (>50%)
5. **Cost of Living**: 18.9% â†’ âœ… Frugal (<30%)
6. **LTV**: 90% â†’ âœ… Standard (max 90%)

**AI Insight:**
"Although DSR is healthy at 30.5%, the per capita income of RM 529 for a family of 7 in Kuala Lumpur indicates hidden financial stress. However, the exceptionally high savings rate of 73% and frugal spending (18.9%) suggest strong financial discipline that may offset this risk."

---

## Testing Checklist

### âœ… Features to Verify

1. **Dynamic Badges**
   - [ ] "Requested" shows actual amount from application
   - [ ] "Tenure" shows period from Application Form
   - [ ] Third badge shows actual loan type (not "F&B (Retail)")

2. **Financial Metrics Section**
   - [ ] Purple gradient card appears below Score Drivers
   - [ ] All 6 metrics display (or 5 if not Car/Housing loan)
   - [ ] Values match calculation formulas
   - [ ] Evidence quotes appear (if available)
   - [ ] Explanations box at bottom

3. **Backwards Compatibility**
   - [ ] Old applications (no metrics) don't crash
   - [ ] Old applications show dynamic badges
   - [ ] Metrics section gracefully hidden if data missing

4. **Responsiveness**
   - [ ] Grid adapts to screen size
   - [ ] Cards readable on smaller screens
   - [ ] Text doesn't overflow

### ğŸ” Where to Look

1. Go to: http://localhost:3000
2. Upload new application OR open existing one
3. Scroll to **before** "Score Drivers" section
4. Check the 3 badges (Requested, Tenure, Loan Type)
5. Scroll to **after** "Score Drivers" section
6. Look for purple "Financial Metrics Analysis" card

---

## Common Issues & Solutions

### Issue: Metrics section not showing
**Cause**: Old application or AI analysis failed  
**Solution**: Upload a NEW application with 4 documents

### Issue: Badges still showing "24 Months" or "F&B"
**Cause**: Browser cache  
**Solution**: Hard refresh (Ctrl+Shift+R) or clear cache

### Issue: Frontend not updating
**Cause**: Hot reload didn't trigger  
**Solution**: Restart frontend server or save page.tsx again

### Issue: Backend error on analysis
**Cause**: AI prompt change  
**Solution**: Check backend logs for JSON parsing errors

---

**Created**: 2025-01-25  
**For**: TrustLens AI Financial Metrics Update
